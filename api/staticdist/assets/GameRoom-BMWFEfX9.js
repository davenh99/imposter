import{u as P,k as U,a as W,c as x,o as I,b as L,t as a,i as c,d as v}from"./index-O0OhPoee.js";import{g as j,G as $,a as E}from"./api-N5PQaMAh.js";var H=a('<div class="min-h-screen bg-cover bg-[url(/img/46840.jpg)] flex items-center justify-center p-4"><div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full"><div class="text-center mb-8"><h2 class="text-3xl font-bold text-gray-800 mb-2">Game'),N=a('<div class=text-center><div class="text-6xl font-bold text-yellow-600 mb-4">ðŸ«©</div><h3 class="text-2xl font-bold text-gray-800 mb-4">Game In Progress</h3><p class="text-gray-600 mb-8">who da imposter à¶ž</p><div class="flex gap-3">'),O=a('<div class="text-center text-gray-500 py-8"><p>Loading game...'),T=a(`<div class=text-center><img src=/img/hamster.svg alt=Imposter class="mx-auto mb-4 w-50 h-50"><h3 class="text-2xl font-bold text-gray-800 mb-4">You are the Imposter!</h3><p class="text-gray-600 mb-8">Don't get found out!!!! ðŸ˜³`),D=a(`<div class=text-center><div class="text-6xl font-bold text-green-600 mb-4">âœ“</div><h3 class="text-xl font-bold text-gray-800 mb-4">The Word Is:</h3><div class="bg-gradient-to-r from-blue-100 to-purple-100 rounded-lg p-8 mb-8"><p class="text-4xl font-bold text-blue-600"></p></div><p class=text-gray-600>Don't let the imposter figure this out!`);function J(){const w=P(),i=U(),l=W(),o=w.code,m=new URLSearchParams(i.search).get("name")||"Player",p=m==="Host",y=new URLSearchParams(i.search).get("role"),_=new URLSearchParams(i.search).get("word"),[f,S]=x(y||null),[G,u]=x(_||null),d=j();let r=null;function k(){return E(`/api/v1/ws/${o}`)}function R(){fetch(`${d}/api/v1/lobbies/${o}/end`,{method:"POST"}).then(e=>{if(!e.ok)throw new Error("failed to end game");l(`/lobby/${o}?name=Host`)}).catch(e=>{console.error("End game failed:",e),l(`/lobby/${o}?name=Host`)})}function C(){fetch(`${d}/api/v1/lobbies/${o}/restart`,{method:"POST"}).then(e=>{if(!e.ok)throw new Error("failed to restart game");console.log("Game restarted")}).catch(e=>{console.error("Restart game failed:",e)})}return I(async()=>{try{if(!(await fetch(`${d}/api/v1/lobbies/${o}`)).ok){console.error("Lobby not found, redirecting to home"),l("/");return}}catch(e){console.error("Error checking lobby:",e),l("/");return}r=new WebSocket(k()+`?name=${encodeURIComponent(m)}`),r.onopen=()=>{console.log("GameRoom WebSocket opened, sending join message")},r.onmessage=e=>{try{const t=JSON.parse(e.data);if(console.log("GameRoom received message:",t),t.type==="game_ended"){console.log("Game ended, navigating back to lobby/join"),l(p?`/lobby/${o}?name=Host`:`/join/${o}?name=${encodeURIComponent(m)}`);return}t.type==="game_started"&&(console.log("Game started (or restarted), role:",t.role,"word:",t.word),S(t.role||null),t.word?u(t.word):u(null)),t.type==="lobby_state"&&console.log("Ignoring lobby_state in game room")}catch(t){console.error("WebSocket message error:",t)}},r.onerror=e=>{console.error("WebSocket error in GameRoom:",e)},r.onclose=()=>{console.log("WebSocket closed in GameRoom")}}),L(()=>{r&&r.close()}),(()=>{var e=H(),t=e.firstChild;return t.firstChild,c(t,()=>p?(()=>{var s=N(),g=s.firstChild,b=g.nextSibling,h=b.nextSibling,n=h.nextSibling;return c(n,v($,{onClick:R,class:"flex-1 bg-red-600 hover:bg-red-700",children:"End Game"}),null),c(n,v($,{onClick:C,variant:"secondary",class:"flex-1",children:"New Game"}),null),s})():f()===null?O():f()==="imposter"?T():(()=>{var s=D(),g=s.firstChild,b=g.nextSibling,h=b.nextSibling,n=h.firstChild;return c(n,G),s})(),null),e})()}export{J as default};
