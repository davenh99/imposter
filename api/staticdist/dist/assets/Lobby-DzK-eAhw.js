import{u as L,a as T,c,o as B,b as F,t as p,i as t,m as S,d as w}from"./index-2AqZPfgG.js";import{G as U}from"./GameButton-D9sBQ2HM.js";import{G as Y}from"./GameInput-9T7UXaTW.js";var q=p('<div class="min-h-screen bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600 flex items-center justify-center p-4"><div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full"><div class="text-center mb-8"><h2 class="text-3xl font-bold text-gray-800 mb-2">Lobby</h2><p class="text-gray-500 text-sm">You are the host</p></div><div class="bg-gray-100 rounded-lg p-6 mb-6"><p class="text-gray-600 text-sm mb-2">Share this code with friends:</p><p class="text-4xl font-bold text-blue-600 text-center tracking-wider"></p></div><div class=mb-6><p class="text-gray-700 font-semibold mb-3">Players in lobby: <span class=text-blue-600></span></p><div class="space-y-2 min-h-12"></div></div><div class=mb-6>'),z=p('<span class="text-gray-400 text-sm">Waiting for players to join...'),A=p('<span class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium mr-2">'),D=p('<p class="text-xs text-gray-500 mt-2">Max: <!> for <!> player');function R(){const C=L(),b=T(),l=C.code,[s,k]=c([]),[g,G]=c(""),[I,n]=c(""),[d,f]=c(!1);let o=null;function P(){return`${location.protocol==="https:"?"wss":"ws"}://${location.host}/api/v1/ws/${l}`}async function N(){n("");const r=s().length,e=parseInt(g(),10);if(!g().trim()){n("Please enter number of imposters");return}if(isNaN(e)||e<1||e>=r){n(`Must have 1 to ${Math.max(1,r-1)} imposters for ${r} players`);return}f(!0);try{if(!(await fetch(`/api/v1/lobbies/${l}/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imposters:e})})).ok){n("Failed to start game. Please try again.");return}console.log("Game started"),b(`/game/${l}`)}catch(i){console.error("Error starting game:",i),n("Error starting game. Please try again.")}finally{f(!1)}}return B(()=>{o=new WebSocket(P()),o.onmessage=r=>{try{const e=JSON.parse(r.data);e.type==="lobby_state"&&k(e.players||[]),e.type==="game_started"&&(console.log("Game started via WebSocket"),b(`/game/${l}`))}catch(e){console.error("WebSocket message error:",e)}}}),F(()=>{o&&o.close()}),(()=>{var r=q(),e=r.firstChild,i=e.firstChild,x=i.nextSibling,M=x.firstChild,E=M.nextSibling,h=x.nextSibling,y=h.firstChild,W=y.firstChild,j=W.nextSibling,O=y.nextSibling,$=h.nextSibling;return t(E,l),t(j,()=>s().length),t(O,(()=>{var u=S(()=>s().length===0);return()=>u()?z():s().map(a=>(()=>{var m=A();return t(m,a),m})())})()),t($,w(Y,{get value(){return g()},onInput:G,label:"Number of Imposters",placeholder:"1",type:"number",get error(){return I()}}),null),t($,(()=>{var u=S(()=>s().length>0);return()=>u()&&(()=>{var a=D(),m=a.firstChild,_=m.nextSibling,J=_.nextSibling,v=J.nextSibling;return v.nextSibling,t(a,()=>Math.max(1,s().length-1),_),t(a,()=>s().length,v),t(a,()=>s().length!==1?"s":"",null),a})()})(),null),t(e,w(U,{onClick:N,get disabled(){return d()||s().length===0},class:"w-full",get children(){return d()?"Starting...":"Start Game"}}),null),r})()}export{R as default};
